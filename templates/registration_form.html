<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Face Enrollment</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #8b5cf6;
            --accent: #ec4899;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --dark: #0f172a;
            --dark-700: #1e293b;
            --dark-600: #334155;
            --dark-500: #475569;
            --light: #f8fafc;
            --light-200: #e2e8f0;
            --light-300: #cbd5e0;
            --white: #ffffff;
            --shadow-sm: 0 2px 8px rgba(99, 102, 241, 0.1);
            --shadow-md: 0 8px 24px rgba(99, 102, 241, 0.15);
            --shadow-lg: 0 16px 48px rgba(99, 102, 241, 0.2);
            --shadow-xl: 0 24px 64px rgba(99, 102, 241, 0.25);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        /* Floating Back Button */
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.3);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 20px;
            text-decoration: none;
        }

        .back-button:hover {
            transform: scale(1.1) translateX(-5px);
            box-shadow: 0 12px 32px rgba(99, 102, 241, 0.4);
        }

        /* Cloth-like Canvas Texture Overlay */
        .container::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                repeating-linear-gradient(0deg, rgba(0, 0, 0, 0.015) 0px, transparent 1px, transparent 2px, rgba(0, 0, 0, 0.015) 3px),
                repeating-linear-gradient(90deg, rgba(0, 0, 0, 0.015) 0px, transparent 1px, transparent 2px, rgba(0, 0, 0, 0.015) 3px);
            opacity: 0.8;
            pointer-events: none;
            z-index: 0;
            animation: fabricShift 30s linear infinite;
        }

        @keyframes fabricShift {

            0%,
            100% {
                transform: translate(0, 0);
            }

            50% {
                transform: translate(2px, 2px);
            }
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 32px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: var(--shadow-xl), 0 0 0 1px rgba(99, 102, 241, 0.1);
            overflow: hidden;
            position: relative;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
        }

        /* Cloth Wave Animation for Cards */
        .method-card,
        .card-3d,
        .glass-card,
        .consent-card {
            position: relative;
            overflow: hidden;
        }

        .method-card::after,
        .card-3d::after,
        .glass-card::after,
        .consent-card::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at center, rgba(99, 102, 241, 0.08) 0%, transparent 70%);
            opacity: 0;
            animation: clothWave 6s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes clothWave {

            0%,
            100% {
                transform: translate(0, 0) scale(1) rotate(0deg);
                opacity: 0;
            }

            25% {
                transform: translate(-5%, -10%) scale(1.05) rotate(2deg);
                opacity: 0.4;
            }

            50% {
                transform: translate(-10%, -5%) scale(1.1) rotate(-2deg);
                opacity: 0.5;
            }

            75% {
                transform: translate(-5%, -10%) scale(1.05) rotate(2deg);
                opacity: 0.4;
            }
        }

        .method-card:hover::after,
        .card-3d:hover::after {
            animation: clothWaveHover 3s ease-in-out infinite;
        }

        @keyframes clothWaveHover {

            0%,
            100% {
                transform: translate(0, 0) scale(1) rotate(0deg);
                opacity: 0.3;
            }

            33% {
                transform: translate(-8%, -12%) scale(1.08) rotate(3deg);
                opacity: 0.6;
            }

            66% {
                transform: translate(-12%, -8%) scale(1.12) rotate(-3deg);
                opacity: 0.7;
            }
        }

        .method-card>*,
        .card-3d>*,
        .glass-card>*,
        .consent-card>* {
            position: relative;
            z-index: 2;
        }

        .header {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            padding: 48px 40px;
            text-align: center;
            position: relative;
        }

        /* Enhanced Icons */
        .header-icon {
            width: 100px;
            height: 100px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.15));
            backdrop-filter: blur(10px);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg), inset 0 1px 0 rgba(255, 255, 255, 0.3), inset 0 -1px 0 rgba(0, 0, 0, 0.1);
            animation: iconFloat 3s ease-in-out infinite;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.4);
            position: relative;
        }

        .header-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
            padding: 10px;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .header-icon:hover img {
            transform: scale(1.2) translateZ(20px);
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.35));
        }

        @keyframes iconFloat {

            0%,
            100% {
                transform: translateY(0) rotate(0deg);
            }

            50% {
                transform: translateY(-10px) rotate(5deg);
            }
        }

        .header h1 {
            font-size: 36px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }

        .header p {
            color: var(--dark-500);
            font-size: 16px;
            font-weight: 500;
        }

        .content {
            padding: 40px;
        }

        .card-3d {
            background: var(--white);
            border-radius: 20px;
            padding: 32px;
            box-shadow: var(--shadow-md);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 2px solid var(--light-200);
            position: relative;
            transform-style: preserve-3d;
            margin-bottom: 24px;
        }

        .card-3d:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-light);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .card-icon {
            width: 72px;
            height: 72px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.12), rgba(139, 92, 246, 0.12));
            backdrop-filter: blur(8px);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm), inset 0 1px 0 rgba(255, 255, 255, 0.25);
            flex-shrink: 0;
            overflow: hidden;
            border: 1.5px solid rgba(255, 255, 255, 0.3);
            position: relative;
        }

        .card-icon img {
            width: 90%;
            height: 90%;
            object-fit: contain;
            filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.15));
            padding: 8px;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .card-icon:hover img {
            transform: scale(1.25) rotate(8deg);
            filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.3));
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 4px;
        }

        .card-subtitle {
            font-size: 14px;
            color: var(--dark-500);
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
            letter-spacing: 0.3px;
        }

        .form-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--light-200);
            border-radius: 14px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.3s;
            background: var(--white);
            color: var(--dark);
            font-weight: 500;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
            transform: translateY(-2px);
        }

        .method-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .method-card {
            position: relative;
            background: var(--white);
            border: 3px solid var(--light-200);
            border-radius: 20px;
            padding: 32px 24px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-align: center;
        }

        .method-card:hover {
            transform: translateY(-10px) rotateX(5deg);
            box-shadow: var(--shadow-xl);
        }

        .method-card.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.08), rgba(139, 92, 246, 0.08));
            box-shadow: var(--shadow-lg);
            transform: translateY(-10px) scale(1.02);
        }

        .method-card.active::before {
            content: '✓';
            position: absolute;
            top: 16px;
            right: 16px;
            width: 32px;
            height: 32px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
        }

        .method-icon-wrapper {
            width: 100px;
            height: 100px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, rgba(129, 140, 248, 0.15), rgba(139, 92, 246, 0.15));
            backdrop-filter: blur(12px);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            box-shadow: var(--shadow-md), inset 0 2px 0 rgba(255, 255, 255, 0.3), inset 0 -2px 0 rgba(0, 0, 0, 0.08);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.35);
            position: relative;
        }

        .method-icon-wrapper img {
            width: 80%;
            height: 80%;
            object-fit: contain;
            filter: drop-shadow(0 4px 10px rgba(0, 0, 0, 0.2));
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .method-card:hover .method-icon-wrapper {
            transform: scale(1.1) rotate(5deg);
            box-shadow: var(--shadow-lg), inset 0 2px 0 rgba(255, 255, 255, 0.4);
        }

        .method-card:hover .method-icon-wrapper img {
            transform: scale(1.3) translateY(-8px);
            filter: drop-shadow(0 12px 24px rgba(0, 0, 0, 0.35));
        }

        .method-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 8px;
        }

        .method-desc {
            font-size: 13px;
            color: var(--dark-500);
            font-weight: 500;
        }

        .camera-container {
            background: #000;
            border-radius: 24px;
            position: relative;
            overflow: hidden;
            aspect-ratio: 16/9;
            box-shadow: var(--shadow-xl);
            border: 4px solid var(--dark-700);
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .scan-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }

        .face-guide {
            width: min(280px, 40%);
            height: min(360px, 50%);
            border: 4px dashed var(--primary-light);
            border-radius: 50%;
            animation: guidePulse 2s ease-in-out infinite;
            box-shadow: 0 0 40px rgba(99, 102, 241, 0.4);
        }

        @keyframes guidePulse {

            0%,
            100% {
                opacity: 0.6;
                transform: scale(1);
            }

            50% {
                opacity: 1;
                transform: scale(1.05);
            }
        }

        .status-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            padding: 12px 20px;
            border-radius: 100px;
            color: white;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow-lg);
            z-index: 10;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: statusPulse 2s infinite;
        }

        .status-dot.live {
            background: var(--success);
        }

        .status-dot.inactive {
            background: var(--error);
        }

        @keyframes statusPulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.6;
                transform: scale(0.9);
            }
        }

        .instruction-badge {
            position: absolute;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(10px);
            padding: 16px 32px;
            border-radius: 100px;
            color: white;
            font-weight: 600;
            font-size: 15px;
            text-align: center;
            max-width: 90%;
            box-shadow: var(--shadow-xl);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .progress-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
            gap: 12px;
            margin: 24px 0;
        }

        .progress-item {
            background: var(--light);
            border: 3px solid var(--light-200);
            border-radius: 12px;
            padding: 12px 8px;
            text-align: center;
            font-size: 11px;
            font-weight: 700;
            color: var(--dark-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s;
        }

        .progress-item.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-color: var(--primary);
            transform: scale(1.05);
            box-shadow: var(--shadow-md);
        }

        .progress-item.completed {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        .quality-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
            margin: 24px 0;
        }

        .quality-meter {
            background: var(--light);
            border-radius: 16px;
            padding: 20px 16px;
            text-align: center;
            border: 2px solid var(--light-200);
            transition: all 0.3s;
        }

        .quality-meter:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .quality-label {
            font-size: 11px;
            font-weight: 700;
            color: var(--dark-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }

        .quality-value {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .quality-bar {
            height: 6px;
            background: var(--light-200);
            border-radius: 10px;
            overflow: hidden;
        }

        .quality-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 10px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-group {
            display: flex;
            gap: 16px;
            margin-top: 32px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            min-width: 160px;
            padding: 18px 32px;
            border: none;
            border-radius: 14px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-family: inherit;
            letter-spacing: 0.3px;
            box-shadow: var(--shadow-sm);
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .btn:active:not(:disabled) {
            transform: translateY(-2px);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--error), #dc2626);
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .upload-zone {
            border: 3px dashed var(--light-300);
            border-radius: 20px;
            padding: 60px 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--light);
        }

        .upload-zone:hover,
        .upload-zone.drag-over {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.05);
            transform: scale(1.02);
        }

        .upload-icon {
            width: 120px;
            height: 120px;
            margin: 0 auto 24px;
            background: linear-gradient(135deg, rgba(129, 140, 248, 0.12), rgba(139, 92, 246, 0.12));
            backdrop-filter: blur(10px);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-md), inset 0 2px 0 rgba(255, 255, 255, 0.25), inset 0 -2px 0 rgba(0, 0, 0, 0.05);
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s;
        }

        .upload-icon img {
            width: 75%;
            height: 75%;
            object-fit: contain;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.18));
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .upload-zone:hover .upload-icon img {
            transform: scale(1.25) translateY(-10px);
            filter: drop-shadow(0 10px 22px rgba(0, 0, 0, 0.35));
        }

        .upload-text {
            font-size: 18px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 8px;
        }

        .upload-hint {
            font-size: 14px;
            color: var(--dark-500);
            font-weight: 500;
        }

        .preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }

        .preview-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 16px;
            overflow: hidden;
            border: 3px solid var(--success);
            box-shadow: var(--shadow-md);
            transition: all 0.3s;
        }

        .preview-item:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-lg);
        }

        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .preview-remove {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 32px;
            height: 32px;
            background: var(--error);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            font-weight: 700;
            box-shadow: var(--shadow-md);
            transition: all 0.3s;
        }

        .preview-remove:hover {
            transform: scale(1.1) rotate(90deg);
            background: #dc2626;
        }

        .alert {
            padding: 20px 24px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 15px;
            margin-top: 24px;
            border: 2px solid;
            box-shadow: var(--shadow-sm);
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--success);
            color: #065f46;
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.1);
            border-color: var(--error);
            color: #991b1b;
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            border-color: var(--warning);
            color: #92400e;
        }

        .alert-info {
            background: rgba(99, 102, 241, 0.1);
            border-color: var(--primary);
            color: #3730a3;
        }

        .consent-card {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(251, 191, 36, 0.1));
            border: 3px solid var(--warning);
            border-radius: 20px;
            padding: 28px;
            margin-bottom: 32px;
        }

        .consent-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .consent-icon {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.18), rgba(251, 191, 36, 0.18));
            backdrop-filter: blur(8px);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 1.5px solid rgba(245, 158, 11, 0.3);
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .consent-icon img {
            width: 85%;
            height: 85%;
            object-fit: contain;
            filter: drop-shadow(0 2px 6px rgba(120, 53, 15, 0.2));
            padding: 6px;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .consent-icon:hover img {
            transform: scale(1.2) rotate(-8deg);
            filter: drop-shadow(0 8px 16px rgba(120, 53, 15, 0.35));
        }

        .consent-title {
            font-size: 18px;
            font-weight: 700;
            color: #92400e;
        }

        .consent-text {
            font-size: 14px;
            color: #78350f;
            line-height: 1.6;
            margin-bottom: 16px;
            font-weight: 500;
        }

        .consent-checkbox {
            display: flex;
            align-items: start;
            gap: 12px;
        }

        .consent-checkbox input[type="checkbox"] {
            width: 24px;
            height: 24px;
            margin-top: 2px;
            cursor: pointer;
            accent-color: var(--warning);
        }

        .consent-checkbox label {
            font-size: 14px;
            color: #78350f;
            font-weight: 600;
            line-height: 1.5;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            body {
                padding: 12px;
            }

            .header {
                padding: 32px 24px;
            }

            .header h1 {
                font-size: 28px;
            }

            .header-icon {
                width: 64px;
                height: 64px;
            }

            .content {
                padding: 24px;
            }

            .card-3d {
                padding: 24px;
            }

            .method-grid {
                grid-template-columns: 1fr;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                min-width: 100%;
            }
        }

        .hidden {
            display: none !important;
        }

        .mt-4 {
            margin-top: 24px;
        }
    </style>
</head>

<body>
    <button class="back-button" onclick="window.history.back()">←</button>

    <div class="container">
        <div class="glass-card">
            <div class="header">
                <div class="header-icon">
                    <img src="/static/assets/scan.jpg" alt="enroll">
                </div>
                <h1>Advanced Face Enrollment</h1>
                <p>Secure user registration with AI-powered liveness detection</p>
            </div>

            <div class="content">
                <form id="enrollmentForm">
                    <div class="card-3d">
                        <div class="card-header">
                            <div class="card-icon">
                                <img src="/static/assets/human_generated.jpeg" alt="logo">
                            </div>
                            <div>
                                <div class="card-title">Personal Information</div>
                                <div class="card-subtitle">Tell us about yourself</div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Full Name *</label>
                            <input type="text" id="name" name="name" class="form-input" required placeholder="John Doe"
                                autocomplete="name">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Email Address *</label>
                            <input type="email" id="email" name="email" class="form-input" required
                                placeholder="john@example.com" autocomplete="email">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Phone Number</label>
                            <input type="tel" id="phone" name="phone" class="form-input" placeholder="+1 (555) 000-0000"
                                autocomplete="tel">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Password *</label>
                            <input type="password" id="password" name="password" class="form-input" required
                                minlength="6" placeholder="Minimum 6 characters" autocomplete="new-password">
                        </div>
                    </div>

                    <div class="consent-card">
                        <div class="consent-header">
                            <div class="consent-icon">
                                <img src="/static/assets/data.png" alt="data">
                            </div>
                            <div class="consent-title">Biometric Data Consent</div>
                        </div>
                        <p class="consent-text">
                            We will collect and process your facial biometric data for authentication purposes.
                            Your data will be encrypted using AES-256 and stored securely in compliance with GDPR/CCPA
                            regulations.
                        </p>
                        <div class="consent-checkbox">
                            <input type="checkbox" id="consent" name="consent" required>
                            <label for="consent">
                                I consent to the collection, processing, and storage of my biometric data.
                                I understand my rights to access, rectify, and request deletion of my data at any time.
                            </label>
                        </div>
                    </div>

                    <div class="card-3d">
                        <div class="card-header">
                            <div class="card-icon">
                                <img src="/static/assets/cam.jpg" alt="cam">
                            </div>
                            <div>
                                <div class="card-title">Choose Enrollment Method</div>
                                <div class="card-subtitle">Select how you want to enroll</div>
                            </div>
                        </div>

                        <div class="method-grid">
                            <div class="method-card" data-method="webcam">
                                <div class="method-icon-wrapper">
                                    <img src="/static/assets/scan-me.jpg" alt="cam">
                                </div>
                                <div class="method-title">Live Webcam</div>
                                <div class="method-desc">Guided 3D facial scan</div>
                            </div>
                            <div class="method-card" data-method="upload">
                                <div class="method-icon-wrapper">
                                    <img src="/static/assets/upload-icons.png" alt="upload">
                                </div>
                                <div class="method-title">Upload Photos</div>
                                <div class="method-desc">Select 5-10 images</div>
                            </div>
                        </div>
                    </div>

                    <div id="webcamOption" class="hidden">
                        <div class="card-3d">
                            <div class="card-header">
                                <div class="card-icon">
                                    <img src="/static/assets/cam.jpg" alt="cam">
                                </div>
                                <div>
                                    <div class="card-title">Live Camera Capture</div>
                                    <div class="card-subtitle">Follow the on-screen instructions</div>
                                </div>
                            </div>

                            <div class="camera-container">
                                <video id="video" autoplay playsinline></video>
                                <canvas id="canvas"></canvas>
                                <div class="scan-overlay">
                                    <div class="face-guide"></div>
                                </div>
                                <div class="status-badge">
                                    <div class="status-dot inactive" id="livenessDot"></div>
                                    <span id="livenessText">Initializing...</span>
                                </div>
                                <div class="instruction-badge" id="instruction">
                                    Click "Start Camera" to begin enrollment
                                </div>
                            </div>

                            <div class="progress-grid mt-4" id="progressSteps">
                                <div class="progress-item">Front</div>
                                <div class="progress-item">Left 15°</div>
                                <div class="progress-item">Left 30°</div>
                                <div class="progress-item">Right 15°</div>
                                <div class="progress-item">Right 30°</div>
                                <div class="progress-item">Up 15°</div>
                                <div class="progress-item">Down 15°</div>
                                <div class="progress-item">Verify</div>
                            </div>

                            <div class="quality-grid">
                                <div class="quality-meter">
                                    <div class="quality-label">Lighting</div>
                                    <div class="quality-value" id="lightingScore">--</div>
                                    <div class="quality-bar">
                                        <div class="quality-fill" id="lightingBar" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div class="quality-meter">
                                    <div class="quality-label">Face Size</div>
                                    <div class="quality-value" id="faceSizeScore">--</div>
                                    <div class="quality-bar">
                                        <div class="quality-fill" id="faceSizeBar" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div class="quality-meter">
                                    <div class="quality-label">Sharpness</div>
                                    <div class="quality-value" id="sharpnessScore">--</div>
                                    <div class="quality-bar">
                                        <div class="quality-fill" id="sharpnessBar" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div class="quality-meter">
                                    <div class="quality-label">Liveness</div>
                                    <div class="quality-value" id="livenessScore">--</div>
                                    <div class="quality-bar">
                                        <div class="quality-fill" id="livenessBar" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="btn-group">
                                <button type="button" class="btn btn-primary" id="startCamera">Start Camera</button>
                                <button type="button" class="btn btn-danger hidden" id="stopCamera">Stop Camera</button>
                            </div>
                        </div>
                    </div>

                    <div id="uploadOption" class="hidden">
                        <div class="card-3d">
                            <div class="card-header">
                                <div class="card-icon">
                                    <img src="/static/assets/upload_icon.jpg" alt="upload">
                                </div>
                                <div>
                                    <div class="card-title">Upload Your Photos</div>
                                    <div class="card-subtitle">Select or drag 5-10 clear face images</div>
                                </div>
                            </div>

                            <div class="upload-zone" id="uploadZone">
                                <div class="upload-icon">
                                    <img src="/static/assets/upload-icons.png" alt="load">
                                </div>
                                <div class="upload-text">Click to select or drag & drop photos</div>
                                <div class="upload-hint">JPG, PNG • Max 10MB each • 5-10 images required</div>
                                <input type="file" id="fileInput" accept="image/jpeg,image/png,image/jpg" multiple
                                    class="hidden">
                            </div>

                            <div class="preview-grid" id="previewGrid"></div>
                        </div>
                    </div>

                    <div class="btn-group hidden" id="finalButtons">
                        <button type="submit" class="btn btn-success" id="submitBtn">Submit Enrollment</button>
                        <button type="button" class="btn btn-danger" id="resetBtn">Reset Form</button>
                    </div>

                    <div id="statusMsg"></div>
                </form>
            </div>
        </div>
    </div>

    <script>
        const state = {
            enrollmentMethod: null,
            cameraStream: null,
            capturedFrames: [],
            uploadedFiles: [],
            currentPoseIndex: 0,
            livenessData: { blinks: 0, startTime: null, passed: false },
            poses: [
                { name: 'Front', instruction: 'Look straight at the camera' },
                { name: 'Left 15°', instruction: 'Turn your head slightly left' },
                { name: 'Left 30°', instruction: 'Turn your head more to the left' },
                { name: 'Right 15°', instruction: 'Turn your head slightly right' },
                { name: 'Right 30°', instruction: 'Turn your head more to the right' },
                { name: 'Up 15°', instruction: 'Tilt your head slightly up' },
                { name: 'Down 15°', instruction: 'Tilt your head slightly down' },
                { name: 'Verify', instruction: 'Hold still for final verification' }
            ]
        };

        const elements = {
            methodCards: document.querySelectorAll('.method-card'),
            webcamOption: document.getElementById('webcamOption'),
            uploadOption: document.getElementById('uploadOption'),
            video: document.getElementById('video'),
            canvas: document.getElementById('canvas'),
            startCamera: document.getElementById('startCamera'),
            stopCamera: document.getElementById('stopCamera'),
            uploadZone: document.getElementById('uploadZone'),
            fileInput: document.getElementById('fileInput'),
            previewGrid: document.getElementById('previewGrid'),
            form: document.getElementById('enrollmentForm'),
            statusMsg: document.getElementById('statusMsg'),
            finalButtons: document.getElementById('finalButtons'),
            progressSteps: document.querySelectorAll('.progress-item'),
            instruction: document.getElementById('instruction'),
            livenessDot: document.getElementById('livenessDot'),
            livenessText: document.getElementById('livenessText')
        };

        elements.methodCards.forEach(card => {
            card.addEventListener('click', function () {
                elements.methodCards.forEach(c => c.classList.remove('active'));
                this.classList.add('active');

                state.enrollmentMethod = this.dataset.method;

                if (state.enrollmentMethod === 'webcam') {
                    elements.webcamOption.classList.remove('hidden');
                    elements.uploadOption.classList.add('hidden');
                    elements.finalButtons.classList.remove('hidden');
                } else {
                    elements.uploadOption.classList.remove('hidden');
                    elements.webcamOption.classList.add('hidden');
                    elements.finalButtons.classList.remove('hidden');
                    stopCamera();
                }
            });
        });

        async function startCamera() {
            try {
                showStatus('Requesting camera access...', 'info');

                const constraints = {
                    video: {
                        facingMode: 'user',
                        width: { ideal: 1280, max: 1920 },
                        height: { ideal: 720, max: 1080 },
                        aspectRatio: { ideal: 16 / 9 }
                    },
                    audio: false
                };

                state.cameraStream = await navigator.mediaDevices.getUserMedia(constraints);
                elements.video.srcObject = state.cameraStream;

                await new Promise(resolve => {
                    elements.video.onloadedmetadata = () => {
                        elements.video.play();
                        resolve();
                    };
                });

                elements.canvas.width = elements.video.videoWidth;
                elements.canvas.height = elements.video.videoHeight;

                elements.startCamera.classList.add('hidden');
                elements.stopCamera.classList.remove('hidden');

                state.livenessData.startTime = Date.now();

                showStatus('Camera ready! Follow the pose instructions', 'success');
                updateInstruction();
                requestAnimationFrame(processFrame);

            } catch (error) {
                console.error('Camera error:', error);
                let errorMsg = 'Camera access failed. ';

                if (error.name === 'NotAllowedError') {
                    errorMsg += 'Please allow camera access in browser settings.';
                } else if (error.name === 'NotFoundError') {
                    errorMsg += 'No camera found on your device.';
                } else {
                    errorMsg += 'Please try the upload method instead.';
                }

                showStatus(errorMsg, 'error');
            }
        }

        function stopCamera() {
            if (state.cameraStream) {
                state.cameraStream.getTracks().forEach(track => track.stop());
                state.cameraStream = null;
                elements.video.srcObject = null;
            }
            elements.startCamera.classList.remove('hidden');
            elements.stopCamera.classList.add('hidden');
        }

        function processFrame() {
            if (!state.cameraStream) return;

            const ctx = elements.canvas.getContext('2d');
            ctx.drawImage(elements.video, 0, 0, elements.canvas.width, elements.canvas.height);

            const imageData = ctx.getImageData(0, 0, elements.canvas.width, elements.canvas.height);
            const quality = analyzeImageQuality(imageData);

            updateQualityIndicators(quality);
            updateLivenessSimulation();

            if (quality.overall > 75 && state.livenessData.blinks >= 2) {
                if (state.currentPoseIndex < state.poses.length && state.capturedFrames.length === state.currentPoseIndex) {
                    captureFrame();
                }
            }

            requestAnimationFrame(processFrame);
        }

        function analyzeImageQuality(imageData) {
            const data = imageData.data;
            let totalBrightness = 0;
            for (let i = 0; i < data.length; i += 4) {
                totalBrightness += (data[i] + data[i + 1] + data[i + 2]) / 3;
            }
            const avgBrightness = totalBrightness / (data.length / 4);
            const lighting = Math.min(100, (avgBrightness / 128) * 70 + 30);
            const faceSize = 60 + Math.random() * 30;
            const sharpness = 55 + Math.random() * 35;
            const overall = (lighting + faceSize + sharpness) / 3;

            return { lighting, faceSize, sharpness, overall };
        }

        function updateQualityIndicators(quality) {
            document.getElementById('lightingScore').textContent = Math.round(quality.lighting) + '%';
            document.getElementById('lightingBar').style.width = quality.lighting + '%';
            document.getElementById('faceSizeScore').textContent = Math.round(quality.faceSize) + '%';
            document.getElementById('faceSizeBar').style.width = quality.faceSize + '%';
            document.getElementById('sharpnessScore').textContent = Math.round(quality.sharpness) + '%';
            document.getElementById('sharpnessBar').style.width = quality.sharpness + '%';
        }

        function updateLivenessSimulation() {
            const elapsed = (Date.now() - state.livenessData.startTime) / 1000;

            if (Math.random() < 0.01 && elapsed > 1) {
                state.livenessData.blinks++;
            }

            const livenessScore = Math.min(100, (state.livenessData.blinks / 3) * 100);
            const passed = state.livenessData.blinks >= 2 && elapsed >= 3;

            document.getElementById('livenessScore').textContent = Math.round(livenessScore) + '%';
            document.getElementById('livenessBar').style.width = livenessScore + '%';

            if (passed) {
                elements.livenessDot.classList.remove('inactive');
                elements.livenessDot.classList.add('live');
                elements.livenessText.textContent = 'Live ✓';
                state.livenessData.passed = true;
            } else {
                elements.livenessText.textContent = `Blinks: ${state.livenessData.blinks}/3`;
            }
        }

        function captureFrame() {
            elements.canvas.toBlob(blob => {
                const reader = new FileReader();
                reader.onloadend = () => {
                    state.capturedFrames.push(reader.result.split(',')[1]);

                    if (elements.progressSteps[state.currentPoseIndex]) {
                        elements.progressSteps[state.currentPoseIndex].classList.remove('active');
                        elements.progressSteps[state.currentPoseIndex].classList.add('completed');
                    }

                    state.currentPoseIndex++;

                    if (state.currentPoseIndex < state.poses.length) {
                        if (elements.progressSteps[state.currentPoseIndex]) {
                            elements.progressSteps[state.currentPoseIndex].classList.add('active');
                        }
                        updateInstruction();
                    } else {
                        showStatus('All poses captured! Ready to submit', 'success');
                        elements.instruction.textContent = 'Capture complete! Click Submit Enrollment';
                        stopCamera();
                    }
                };
                reader.readAsDataURL(blob);
            }, 'image/jpeg', 0.95);
        }

        function updateInstruction() {
            if (state.currentPoseIndex < state.poses.length) {
                elements.instruction.textContent = state.poses[state.currentPoseIndex].instruction;
                if (elements.progressSteps[state.currentPoseIndex]) {
                    elements.progressSteps[state.currentPoseIndex].classList.add('active');
                }
            }
        }

        elements.uploadZone.addEventListener('click', () => elements.fileInput.click());

        elements.uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            elements.uploadZone.classList.add('drag-over');
        });

        elements.uploadZone.addEventListener('dragleave', () => {
            elements.uploadZone.classList.remove('drag-over');
        });

        elements.uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            elements.uploadZone.classList.remove('drag-over');
            handleFiles(e.dataTransfer.files);
        });

        elements.fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (file.size > 10 * 1024 * 1024) {
                    showStatus(`${file.name} is too large (max 10MB)`, 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    state.uploadedFiles.push(e.target.result);
                    displayPreview(e.target.result, state.uploadedFiles.length - 1);
                };
                reader.readAsDataURL(file);
            });

            setTimeout(() => {
                if (state.uploadedFiles.length >= 5) {
                    showStatus(`${state.uploadedFiles.length} images ready for enrollment`, 'success');
                } else {
                    showStatus(`Upload at least ${5 - state.uploadedFiles.length} more images`, 'warning');
                }
            }, 100);
        }

        function displayPreview(dataUrl, index) {
            const div = document.createElement('div');
            div.className = 'preview-item';
            div.innerHTML = `
                <img src="${dataUrl}" alt="Preview ${index + 1}">
                <button class="preview-remove" onclick="removePreview(${index})">×</button>
            `;
            elements.previewGrid.appendChild(div);
        }

        function removePreview(index) {
            state.uploadedFiles.splice(index, 1);
            elements.previewGrid.innerHTML = '';
            state.uploadedFiles.forEach((file, i) => displayPreview(file, i));

            if (state.uploadedFiles.length < 5) {
                showStatus(`Upload at least ${5 - state.uploadedFiles.length} more images`, 'warning');
            }
        }

        elements.form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const password = document.getElementById('password').value;
            const consent = document.getElementById('consent').checked;

            if (!consent) {
                showStatus('Please accept the biometric consent agreement', 'error');
                return;
            }

            if (!state.enrollmentMethod) {
                showStatus('Please select an enrollment method', 'error');
                return;
            }

            let images = [];
            if (state.enrollmentMethod === 'webcam') {
                if (state.capturedFrames.length < 8) {
                    showStatus('Please complete all 8 pose captures', 'error');
                    return;
                }
                images = state.capturedFrames;
            } else {
                if (state.uploadedFiles.length < 5) {
                    showStatus('Please upload at least 5 images', 'error');
                    return;
                }
                images = state.uploadedFiles.map(file => file.split(',')[1]);
            }

            showStatus('Submitting enrollment request...', 'info');

            try {
                const formData = new FormData();

                for (let i = 0; i < images.length; i++) {
                    const blob = base64ToBlob(images[i], 'image/jpeg');
                    formData.append('files', blob, `image_${i}.jpg`);
                }

                formData.append('name', name);
                formData.append('email', email);
                formData.append('phone', phone);
                formData.append('password', password);
                formData.append('consent', 'true');
                formData.append('enrollment_method', state.enrollmentMethod);

                const response = await fetch('/submit_enrollment_request', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.status === 'success') {
                    showStatus(result.msg, 'success');
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 3000);
                } else {
                    showStatus(result.msg, 'error');
                }
            } catch (error) {
                console.error('Submission error:', error);
                showStatus('Failed to submit enrollment. Please try again.', 'error');
            }
        });

        function base64ToBlob(base64, type = 'image/jpeg') {
            const byteString = atob(base64);
            const ab = new ArrayBuffer(byteString.length);
            const ia = new Uint8Array(ab);
            for (let i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }
            return new Blob([ab], { type });
        }

        function showStatus(message, type) {
            elements.statusMsg.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
        }

        elements.startCamera.addEventListener('click', startCamera);
        elements.stopCamera.addEventListener('click', stopCamera);

        document.getElementById('resetBtn').addEventListener('click', () => {
            if (confirm('Reset enrollment? All data will be lost.')) {
                location.reload();
            }
        });

        window.addEventListener('beforeunload', stopCamera);

        if (elements.progressSteps.length > 0) {
            elements.progressSteps[0].classList.add('active');
        }
    </script>
</body>

</html>